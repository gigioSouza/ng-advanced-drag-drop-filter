!function(){"use strict";function e(e){e.put("nggs.advanced-drag-drop-filter.html",['<div class="advanced-drag-drop-filter">','<div class="control-container">','<div class="filter-selection">',"<label>Filter:</label>",'<select ng-disabled="isEditing" ng-model="selectedFilter" ng-options="option.name for option in filters track by option.id" ng-change="change()"></select>',"</div>",'<div class="buttons-container">','<button ng-if="!isEditing" type="button" ng-click="setDefault()">Set as default</button>','<button ng-if="!isEditing" type="button" ng-click="edit()">Edit</button>','<button ng-if="!isEditing" type="button" ng-click="new()">New</button>','<button ng-if="isEditing" type="button" ng-click="cancel()">Cancel</button>','<button ng-if="isEditing" type="button" ng-click="save()">Save</button>',"</div>","</div>","<div class=\"selected-container {{ isEditing ? 'editing' : '' }}\">",'<div ng-if="isEditing" class="selected-filter-header">','<label>Filter\'s name</label><input type="text" ng-model="editingFilter.name" />',"</div>",'<div class="selected-fields"></div>',"</div>","<div ng-show=\"isEditing\" class=\"available-container {{ isEditing ? 'editing' : '' }}\">","<label>Available fields</label>",'<div class="available-fields">','<div class="available-field" ng-repeat="field in availableFields track by field.id" data-id="{{ ::field.id }}" draggable="true">','<i ng-class="getFieldClass(field)"></i> {{ ::field.name }}',"</div>","</div>","</div>",'<div class="source-fields" ng-transclude></div>',"</div>"].join(""))}function i(){function e(e,i,t){function n(){g(),p()}function l(){d(),b()}function d(){for(;q.firstChild;)q.removeChild(q.firstChild)}function a(){L.onSetDefault({$event:L.selectedFilter})}function r(){L.isEditing=!0,L.editingFilter={id:L.selectedFilter.id,name:L.selectedFilter.name,fields:L.selectedFilter.fields.slice()},u(),v()}function s(e){var i={};return k&&(i[k]=!0),i[e.icon]=!0,i}function c(){d(),L.isEditing=!0,L.editingFilter={id:null,name:null,fields:[]},u(),v()}function o(){}function f(){L.isEditing=!1}function u(){L.availableFields=[],Object.keys($).forEach(function(e){var i=L.editingFilter.fields.indexOf(e),t=$[e];t.field.setAttribute("draggable","true"),-1===i&&L.availableFields.push(t)})}function g(){t(function(){for(var e=S.querySelectorAll("[draggable=true]");x.firstChild;)x.removeChild(x.firstChild);e.forEach(function(e){var i=e.dataset;$[i.id]={id:i.id,name:i.name,icon:i.icon,field:e}}),b()})}function v(){S.addEventListener("dragstart",E,!0),D.addEventListener("dragover",m,!0),q.addEventListener("dragover",m,!0),D.addEventListener("drop",y,!0),q.addEventListener("drop",h,!0)}function b(){L.selectedFilter&&Array.isArray(L.selectedFilter.fields)&&L.selectedFilter.fields.forEach(function(e){$[e].field.setAttribute("draggable","false"),q.appendChild($[e].field)})}function p(){i.on("$destroy",function(){F&&F(),e.$destroy()}),e.$on("$destroy",function(){F&&F()})}function F(){S.removeEventListener("dragstart",E,!0),D.removeEventListener("dragover",m,!0),q.removeEventListener("dragover",m,!0),D.removeEventListener("drop",y,!0),q.removeEventListener("drop",h,!0)}function E(e){C=e.target}function m(e){e.preventDefault()}function h(i){if(A.test(C.className)){var n=L.availableFields.find(function(e){return e.id===C.dataset.id}),l=L.availableFields.indexOf(n);L.availableFields.splice(l,1),L.editingFilter.fields.push(n.id),t(function(){e.$apply(),q.appendChild(n.field)})}}function y(i){if(!A.test(C.className)){var n=$[C.dataset.id],l=L.editingFilter.fields.indexOf(n.id);L.editingFilter.fields.splice(l,1),L.availableFields.push(n),t(function(){q.removeChild(n.field),e.$apply()})}}var C,L=e,S=i[0],$={},k="fa";L.selectedFilter=L.defaultFilter,L.isEditing=!1,L.editingFilter,L.availableFields,L.new=c,L.edit=r,L.save=o,L.cancel=f,L.change=l,L.setDefault=a,L.getFieldClass=s;var A=/available-field/,D=S.querySelector(".available-fields"),q=S.querySelector(".selected-fields"),x=S.querySelector(".source-fields");n()}return{restrict:"E",templateUrl:"nggs.advanced-drag-drop-filter.html",transclude:!0,scope:{filters:"=",defaultFilter:"=default",onSave:"&",onSetDefault:"&"},controller:e}}angular.module("nggs.advanced-drag-drop-filter",[]).run(e).directive("ngAdvancedDragDropFilter",i),e.$inject=["$templateCache"]}();